image: node:10.15.3

pipelines:
  branches:
    master:
      - step:
          caches:
            - node
          name: Deploy to Firebase Development
          deployment: staging
          script:
            - unset CI
            - yarn
            - yarn build_dev
            - pipe: atlassian/firebase-deploy:0.8.0
              variables:
                PROJECT_ID: docs-stream-stage
                KEY_FILE: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiZG9jcy1zdHJlYW0tc3RhZ2UiLAogICJwcml2YXRlX2tleV9pZCI6ICIwOWZmNjYyMmRjZDMxZmRiNzk4YmVjM2I3MGU1YjBjOTkzZThiZDM5IiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUURSVHBXUXA4Q1YybTAzXG5yS29GYkg3bFBYdytGNHZGL1lCRldlcCtkV21XUFhkVXpTMmpLam1MamZkeURTZzNHS29pVFRZUFZDSUlOVzMyXG5QM1BtbjJuUklnTEVhRGZuZ2hYM0pKMWZ6WFNNcXNlblcvN00xb3phRWFLS1ZudXpYSythQkcvYjQvSGN3ZVloXG5OSkhTaUMrdkptOUNNeitEcVNZeVM5MWJEamJCVG1LYldyaUFVV2F1d0d0RG5YZmVQdWd3SWRTd3ZmcGIzczU3XG5rbFNMMmZMSisxTkVxVkZ1K05tNlREU3JPM1pGNngwU3JsM0pxdXMycFlwdnVzYVpwbmJUaXVNV1BEYTdxTG9IXG4wZUt0MXVvcGxHcTEvd3JQMUtHRi9kN1RjYk9BRXJuTVArdE50Vzl3NHFxZnh0ZW1DTld1dnNPSG1jU2NqSS82XG5rWDJGSFJtNUFnTUJBQUVDZ2dFQUFMV1oyMmJFMEhvQk9SK3FiK3NyTTBPN1ZTN2YwQ1l3UDlKU3BMZTEvT0paXG5yZ2xoaEtxQUw4dHAzWGJYUUY1SkxvZWM5a1pmQVgxcW1laHYrczUzOE5OK3pMMHRubVM3S0cxUzlVbU1NUFdHXG5ONG1La0s4eHpWQ0pqWW9zeS95Q1A2YVpvZHFCRWpxM3JDTG5sNHpzdGVvMURLQWppaDV4N1BJbHBPMW8wbVgrXG5LRHFkVzg4WkNLeGs0NUxtTEpPamRnVFU2ZG1uNmdTSmVKN1VJc3laUWhUZDU0cmdSeExkbHhYcnFIQVQ4eWRhXG4xcXM2NFArMzh6cEwzU3NrWGJiQ2h3eWVPWU1QaW1iZUtDdXFzTkx3ZXlPNDFUVlZoVXlrRXFSVHNtbHhQN0tFXG52OTY0U3g1cXRvclU4dnZSUTE1QXRrZU95YlJPVG5xTXVQMDRkTC95NFFLQmdRRDByZW1HYVNXZjA0ZmVBc3RhXG5wR09DaG43Tk8wSTR5L25KYlo1NmRkUzNTWG02cHR4TmhCRExOS0JpL05EVWVvekdHRkU4YXZhZ0JyaHJZMXlCXG5la0VOa1F4eWF4Lysrb1JGK29la0ZwdG1sdGFoaFJzZjdxakRCb2NDS3RMQkRKWGVUYmtNZklFcWF3d2RvWG9MXG5EcGQ5K3VqRHpMdFRoNXlzT05hTFNaaEI4UUtCZ1FEYS9iVFRlajZJZXFUQy83Y3ZjZVVJK0ZoVGM2eTBJSHI2XG5uWXA3aHBxSlYwc0tDUnN4UlVZbGIrN3NocXQvREFwUENWaEErVndmL1h5NEZ1ZzZmajEzVDIwOVU0T242OXFRXG5vUmlkUTVTWm9XQU8yTUl3OUU4NkRKZ1JkVTV5MFg4UjhqTjMxTFVsTTdJM2lJZG83cGhxNU1JS0wxdzE1YU1TXG5JL1JVVkVzTVNRS0JnUURTank4ZGVqTGtuWmFZbVhNQ1orRXluQ2RXMmg0YzNudnd1YUxkNDdUUW5peGhVZUxYXG4ya1RSZWxKam5RamhNUzBmOUNGRWl3Lzltb3J0N3kzV1Jxemd6ZWdXTnRYc0NRMzNZcWVEcitpL21pTE9FTXZNXG42UWJWL2pJRXpYRmNyRVgwYnBKR2lvWmxTSVcrb2cxeW9uWC85Z0tGTFJRdng4NHQ3eVBCN2UxWElRS0JnUUNHXG52RVgvUDEwdUYxYzc2cDFJZ2FqTEpoRWg5eSt3KzdMdWN2TjdJTXYvNkVkdyt6MVJ5UzlwWlQ3NUk3cHNSbm9wXG5PclNqOVVnckhva1hzbkJiWE1Sd25kdTJPYVh0TVAyZXNwODBVeG9nazl0SUJ6RWpjWTAxUi81ZjcyNiswZ3ArXG5maWdRZUR5amtQVDdtZkxHS3RaNEhoc01yU3JzdGtib3FGcHhjQk5ra1FLQmdGS1N4a0xCV1Uxc3FqbGkwVWNNXG5nc0F0S1UyaHFMWFZjNm4yK3hxU2ZiRTN5d3pJdW14VDRqWVphN3FSejQ3UXplUXBOUFZxMGVzdmVXK3VPUFJ2XG44RjVRUHpQclRsRDRJV0tmM1FtNHFGNCtYUmlGWEhDaGtHaStjZUlud3VPTjg4eFVWS3p0OWxOL1Z3VWE1cHcvXG5SY2tjaHU0SjcvZ05iZkJYT3FsbklaUjhcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJmaXJlYmFzZS1hZG1pbnNkay15eTh3dkBkb2NzLXN0cmVhbS1zdGFnZS5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgImNsaWVudF9pZCI6ICIxMTQ2NTYxMjQ3MjE4NTY3MDg4MjQiLAogICJhdXRoX3VyaSI6ICJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCIsCiAgInRva2VuX3VyaSI6ICJodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbiIsCiAgImF1dGhfcHJvdmlkZXJfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjEvY2VydHMiLAogICJjbGllbnRfeDUwOV9jZXJ0X3VybCI6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9yb2JvdC92MS9tZXRhZGF0YS94NTA5L2ZpcmViYXNlLWFkbWluc2RrLXl5OHd2JTQwZG9jcy1zdHJlYW0tc3RhZ2UuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iCn0K
      - step:
          caches:
            - node
          name: Deploy demo production
          deployment: production
          script:
            - unset CI
            - yarn
            - yarn build_prod
            - echo "StrictHostKeyChecking no" >> /etc/ssh/ssh_config
            - ssh $USER_DEMO@$IP_DEMO "mkdir -p /var/www/ds/ci"
            - scp -r build $USER_DEMO@$IP_DEMO:/var/www/ds/ci
            - ssh $USER_DEMO@$IP_DEMO "rm -rf /var/www/ds/build"
            - ssh $USER_DEMO@$IP_DEMO "mv /var/www/ds/ci/build /var/www/ds"
